@extends('layouts.admin')

@section('title', 'Editar Tipo de Documento')
@section('page-title', 'Editar Tipo de Documento')

@section('content')
<div class="max-w-8xl mx-auto">
    {{-- Breadcrumb --}}
    <div class="mb-6">
        <nav class="flex items-center gap-2 text-sm text-gray-600">
            <a href="{{ route('admin.configuracoes.index') }}" class="hover:text-blue-600">Configurações</a>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <a href="{{ route('admin.configuracoes.tipos-documento.index') }}" class="hover:text-blue-600">Tipos de Documento</a>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <span class="text-gray-900 font-medium">Editar: {{ $tipoDocumento->nome }}</span>
        </nav>
    </div>

    {{-- Formulário --}}
    <form method="POST" action="{{ route('admin.configuracoes.tipos-documento.update', $tipoDocumento->id) }}" class="space-y-6">
        @csrf
        @method('PUT')

        {{-- Card Principal --}}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-6">Informações do Tipo</h3>

            <div class="space-y-6">
                {{-- Grid: Nome e Ordem --}}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {{-- Nome --}}
                    <div class="md:col-span-2">
                        <label for="nome" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome do Tipo <span class="text-red-500">*</span>
                        </label>
                        <input type="text" 
                               name="nome" 
                               id="nome" 
                               value="{{ old('nome', $tipoDocumento->nome) }}"
                               required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 @error('nome') border-red-500 @enderror"
                               placeholder="Ex: Alvará Sanitário">
                        @error('nome')
                            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                        @enderror
                    </div>

                    {{-- Ordem --}}
                    <div>
                        <label for="ordem" class="block text-sm font-medium text-gray-700 mb-2">
                            Ordem
                        </label>
                        <input type="number" 
                               name="ordem" 
                               id="ordem" 
                               value="{{ old('ordem', $tipoDocumento->ordem) }}"
                               min="0"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 @error('ordem') border-red-500 @enderror">
                        @error('ordem')
                            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                        @enderror
                    </div>
                </div>

                {{-- Código --}}
                <div>
                    <label for="codigo" class="block text-sm font-medium text-gray-700 mb-2">
                        Código (opcional)
                    </label>
                    <input type="text" 
                           name="codigo" 
                           id="codigo" 
                           value="{{ old('codigo', $tipoDocumento->codigo) }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 @error('codigo') border-red-500 @enderror"
                           placeholder="Ex: alvara_sanitario">
                    <p class="mt-1 text-xs text-gray-500">Se não informado, será gerado automaticamente a partir do nome</p>
                    @error('codigo')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                {{-- Descrição --}}
                <div>
                    <label for="descricao" class="block text-sm font-medium text-gray-700 mb-2">
                        Descrição
                    </label>
                    <textarea name="descricao" 
                              id="descricao" 
                              rows="2"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 @error('descricao') border-red-500 @enderror"
                              placeholder="Descreva o propósito deste tipo (opcional)">{{ old('descricao', $tipoDocumento->descricao) }}</textarea>
                    @error('descricao')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                {{-- Grid: Prazo e Status --}}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {{-- Configuração de Prazo --}}
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <div class="flex items-center mb-3">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <label class="text-sm font-semibold text-gray-900">
                                Configuração de Prazo
                            </label>
                        </div>

                        {{-- Checkbox: Tem Prazo --}}
                        <div class="mb-3">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" 
                                       name="tem_prazo" 
                                       id="tem_prazo" 
                                       value="1"
                                       {{ old('tem_prazo', $tipoDocumento->tem_prazo) ? 'checked' : '' }}
                                       onchange="togglePrazoPadrao()"
                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                                <span class="ms-2 text-sm text-gray-700">Este tipo de documento possui prazo/validade</span>
                            </label>
                            <p class="mt-1 text-xs text-gray-500 ml-6">
                                Ex: Alvarás, Notificações, Licenças, etc.
                            </p>
                        </div>

                        {{-- Campo: Prazo Padrão (opcional) --}}
                        <div id="prazo_padrao_container" style="display: {{ old('tem_prazo', $tipoDocumento->tem_prazo) ? 'block' : 'none' }};">
                            <label for="prazo_padrao_dias" class="block text-sm font-medium text-gray-700 mb-2">
                                Prazo Padrão (opcional)
                            </label>
                            <div class="flex items-center gap-2 mb-3">
                                <input type="number" 
                                       name="prazo_padrao_dias" 
                                       id="prazo_padrao_dias" 
                                       value="{{ old('prazo_padrao_dias', $tipoDocumento->prazo_padrao_dias) }}"
                                       min="1"
                                       class="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 @error('prazo_padrao_dias') border-red-500 @enderror"
                                       placeholder="Ex: 365">
                                <span class="text-sm text-gray-600">dias</span>
                            </div>
                            @error('prazo_padrao_dias')
                                <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                            @enderror
                            <p class="mt-2 text-xs text-gray-500">
                                Se informado, será sugerido automaticamente ao criar o documento. O usuário poderá escolher entre dias corridos ou úteis na criação.
                            </p>

                            {{-- Checkbox: É documento de notificação/fiscalização --}}
                            <div class="mt-4 p-3 bg-white border border-gray-200 rounded-lg">
                                <label class="flex items-start cursor-pointer">
                                    <input type="checkbox" 
                                           name="prazo_notificacao" 
                                           id="prazo_notificacao"
                                           value="1"
                                           {{ old('prazo_notificacao', $tipoDocumento->prazo_notificacao) ? 'checked' : '' }}
                                           class="mt-0.5 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                                    <div class="ml-3">
                                        <span class="text-sm font-medium text-gray-900">Documento de notificação/fiscalização (§1º)</span>
                                        <p class="text-xs text-gray-600 mt-1">
                                            Marque se for: <strong>Notificação, Auto de Infração, Intimação</strong> ou similar.
                                        </p>
                                        <div class="mt-2 text-xs">
                                            <div class="flex items-start gap-1.5 text-amber-700 bg-amber-50 p-2 rounded border border-amber-200">
                                                <svg class="w-3.5 h-3.5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                                </svg>
                                                <div>
                                                    <strong>Se marcado (§1º):</strong>
                                                    <p class="mt-0.5">Prazo inicia quando o estabelecimento visualizar o documento OU após 5 dias úteis da última assinatura.</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start gap-1.5 text-blue-700 bg-blue-50 p-2 rounded mt-1.5 border border-blue-200">
                                                <svg class="w-3.5 h-3.5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                                <span><strong>Se desmarcado:</strong> Prazo fixo contado da data de criação (ex: Alvará válido por 1 ano)</span>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    {{-- Status --}}
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <label for="ativo" class="block text-sm font-semibold text-gray-900 mb-3">
                            Status do Tipo
                        </label>
                        <div class="flex items-center">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" 
                                       name="ativo" 
                                       id="ativo" 
                                       value="1"
                                       {{ old('ativo', $tipoDocumento->ativo) ? 'checked' : '' }}
                                       class="sr-only peer">
                                <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-700">Ativo</span>
                            </label>
                        </div>
                        <p class="mt-2 text-xs text-gray-500">
                            Tipos inativos não aparecem na lista de criação de documentos
                        </p>
                    </div>
                </div>

                {{-- Opção: Permitir Resposta do Estabelecimento --}}
                <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                    <div class="flex items-center mb-3">
                        <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
                        </svg>
                        <label class="text-sm font-semibold text-gray-900">
                            Resposta do Estabelecimento
                        </label>
                    </div>

                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" 
                               name="permite_resposta" 
                               id="permite_resposta"
                               value="1"
                               {{ old('permite_resposta', $tipoDocumento->permite_resposta) ? 'checked' : '' }}
                               class="mt-0.5 w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2">
                        <div class="ml-3">
                            <span class="text-sm font-medium text-gray-900">Permitir que a empresa responda este documento</span>
                            <p class="text-xs text-gray-600 mt-1">
                                Quando marcado, o estabelecimento poderá enviar uma resposta em PDF vinculada a este documento.
                            </p>
                            <div class="mt-2 text-xs">
                                <div class="flex items-start gap-1.5 text-green-700 bg-white p-2 rounded border border-green-200">
                                    <svg class="w-3.5 h-3.5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <div>
                                        <strong>Ideal para:</strong> Notificações Sanitárias, Autos de Infração, Intimações, etc.
                                        <p class="mt-0.5">A resposta ficará vinculada ao documento original e pendente de aprovação pela Vigilância Sanitária.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        {{-- Botões --}}
        <div class="flex items-center justify-end gap-4">
            <a href="{{ route('admin.configuracoes.tipos-documento.index') }}" 
               class="px-6 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                Cancelar
            </a>
            <button type="submit" 
                    class="px-6 py-2.5 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                Salvar Alterações
            </button>
        </div>
    </form>
</div>

<script>
function togglePrazoPadrao() {
    const temPrazo = document.getElementById('tem_prazo');
    const prazoPadraoContainer = document.getElementById('prazo_padrao_container');
    
    if (temPrazo.checked) {
        prazoPadraoContainer.style.display = 'block';
    } else {
        prazoPadraoContainer.style.display = 'none';
        document.getElementById('prazo_padrao_dias').value = '';
    }
}
</script>
@endsection
